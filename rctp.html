
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RCTP METAR Visualizer</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; background-color: white; }
    #canvas { width: 300px; height: 300px; margin: 0 auto; border: 1px solid #ccc; border-radius: 50%; position: relative; }
    #windArrow {
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-bottom: 150px solid red;
      position: absolute;
      top: 0;
      left: 146px;
      transform-origin: bottom center;
    }
    .info { margin-top: 20px; font-size: 18px; }
    .red { color: red; }
    .icon { width: 50px; vertical-align: middle; }
    #runway {
      position: absolute;
      width: 15px;
      height: 180px;
      background: black;
      top: 60px;
      left: 145px;
      transform-origin: center;
    }
    .angle-label {
      position: absolute;
      font-size: 14px;
      color: #555;
      transform: translate(-50%, -50%);
    }
    .compass-label {
      position: absolute;
      font-size: 12px;
      font-weight: bold;
      color: #222;
      transform: translate(-50%, -50%);
    }
    .explanation {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #ccc;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      font-size: 16px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <h2>RCTP METAR Visualizer</h2>
  <textarea id="metarInput" rows="5" cols="60" placeholder="Paste your METAR here..."></textarea><br><br>
  <button onclick="parseMETAR()">Visualize</button>

  <div class="info" id="weatherInfo"></div>

  <div id="canvas">
    <div id="runway"></div>
    <div id="windArrow"></div>
  </div>

  <div class="explanation">
    <h3>è³‡è¨Šèªªæ˜ï¼š</h3>
    <ul>
      <li><strong>æ©Ÿå ´ ICAO ä»£ç¢¼</strong>ï¼šé¡¯ç¤ºå ±å‘Šæ‰€å±¬æ©Ÿå ´ä»£ç¢¼ï¼Œä¾‹å¦‚ RCTPã€‚</li>
      <li><strong>å¤©æ°£åœ–ç¤º</strong>ï¼šâ˜€ï¸ï¼ˆæ™´å¤©ï¼‰ã€ğŸŒ§ï¸ï¼ˆé™é›¨ï¼‰ã€ğŸŒ«ï¸ï¼ˆéœ§ï¼‰ã€â“ï¼ˆä¸æ˜å¤©æ°£ï¼‰ã€‚</li>
      <li><strong>é£›è¡Œæ¢ä»¶åˆ†é¡</strong>ï¼šä¾æ“šèƒ½è¦‹åº¦èˆ‡é›²åº•é«˜ï¼Œåˆ†ç‚º VFRã€MVFRã€IFRã€LIFRã€‚</li>
      <li><strong>æ°£è±¡æ•¸æ“š</strong>ï¼šé¡¯ç¤ºæº«åº¦ã€èƒ½è¦‹åº¦ã€é›²åº•é«˜åº¦ã€æ°£å£“ã€‚</li>
      <li><strong>æ¨è–¦è·‘é“è™Ÿç¢¼</strong>ï¼šä¾æ“šé¢¨å‘èˆ‡è·‘é“è§’åº¦æ¨è–¦æœ€ä½³ä½¿ç”¨è·‘é“ï¼ˆ05 æˆ– 23ï¼‰ã€‚</li>
      <li><strong>é¢¨èˆ‡è·‘é“è§’åº¦å·®</strong>ï¼šæŒ‡å‡ºé¢¨å‘èˆ‡è·‘é“æ–¹å‘çš„å¤¾è§’ï¼Œå¹«åŠ©åˆ¤æ–·æ˜¯å¦ç‚ºé †é¢¨ã€å´é¢¨ã€‚</li>
    </ul>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    for (let i = 0; i < 360; i += 30) {
      const label = document.createElement("div");
      label.className = "angle-label";
      const radius = 140;
      const rad = (i - 90) * Math.PI / 180;
      label.style.left = 150 + radius * Math.cos(rad) + "px";
      label.style.top = 150 + radius * Math.sin(rad) + "px";
      label.innerText = i;
      canvas.appendChild(label);
    }
    const directions = [
      { label: 'N', deg: 0 },
      { label: 'E', deg: 90 },
      { label: 'S', deg: 180 },
      { label: 'W', deg: 270 }
    ];
    directions.forEach(d => {
      const dirLabel = document.createElement("div");
      dirLabel.className = "compass-label";
      const rad = (d.deg - 90) * Math.PI / 180;
      const radius = 120;
      dirLabel.style.left = 150 + radius * Math.cos(rad) + "px";
      dirLabel.style.top = 150 + radius * Math.sin(rad) + "px";
      dirLabel.innerText = d.label;
      canvas.appendChild(dirLabel);
    });

    function parseMETAR() {
      const input = document.getElementById("metarInput").value;
      const icaoMatch = input.match(/^METAR\s+(\w{4})/);
      const windMatch = input.match(/(\d{3})(\d{2})KT/);
      const tempMatch = input.match(/ (\d{2})\/(\d{2}) /);
      const visMatch = input.match(/ (\d{4}) /);
      const ceilingMatch = input.match(/BKN(\d{3})/);
      const pressureMatch = input.match(/Q(\d{4})/);
      const rain = /RA|SHRA/.test(input);
      const mist = /BR/.test(input);
      const clear = !rain && !mist;

      if (!windMatch || !icaoMatch) {
        alert("Missing METAR or wind data");
        return;
      }

      const icao = icaoMatch[1];
      const dir = parseInt(windMatch[1]);
      const speed = parseInt(windMatch[2]);
      const temp = tempMatch ? tempMatch[1] + "Â°C" : "N/A";
      const vis = visMatch ? (parseInt(visMatch[1]) / 1000).toFixed(1) + " km" : "N/A";
      const visVal = visMatch ? parseInt(visMatch[1]) : 9999;
      const ceil = ceilingMatch ? ceilingMatch[1] * 100 + " ft" : "N/A";
      const ceilVal = ceilingMatch ? ceilingMatch[1] * 100 : 10000;
      const pressure = pressureMatch ? pressureMatch[1] + " hPa" : "N/A";

      let category = "VFR";
      if (ceilVal < 500 && visVal < 1600) {
        category = "LIFR";
      } else if (ceilVal < 1000 || visVal < 5000) {
        if (ceilVal < 1000 && visVal >= 5000) {
          category = "MVFR";
        } else if (ceilVal >= 1000 && visVal < 5000) {
          category = "MVFR";
        } else {
          category = "IFR";
        }
      }

      const windArrow = document.getElementById("windArrow");
      const rotation = (dir + 180) % 360;
      windArrow.style.transform = `rotate(${rotation}deg)`;

      const runwayMap = {
        RCTP: [50, 230]
      };

      let rwy = runwayMap[icao] || [50, 230];
      const rwy1 = rwy[0];
      const rwy2 = rwy[1];
      const runwayHeading = rwy1;
      document.getElementById("runway").style.transform = `rotate(${runwayHeading}deg)`;

      let icon = clear ? "â˜€ï¸" : rain ? "ğŸŒ§ï¸" : mist ? "ğŸŒ«ï¸" : "â“";

      function angleDiff(a, b) {
        let diff = Math.abs(a - b) % 360;
        return diff > 180 ? 360 - diff : diff;
      }
      const diff1 = angleDiff(dir, rwy1);
      const diff2 = angleDiff(dir, rwy2);
      const bestRwy = diff1 < diff2 ? String(Math.round(rwy1 / 10)).padStart(2, '0') : String(Math.round(rwy2 / 10)).padStart(2, '0');
      const angleToRwy = Math.min(diff1, diff2);
      const windType = angleToRwy <= 30 ? "Headwind" : angleToRwy >= 60 ? "Crosswind" : "Partial headwind";

      document.getElementById("weatherInfo").innerHTML = `
        <div><strong>Airport:</strong> ${icao}</div>
        <div><strong>Weather:</strong> ${icon}</div>
        <div><strong>Flight Category:</strong> <span class="${category === 'IFR' ? 'red' : 'gray'}">${category}</span></div>
        <div><strong>Temp:</strong> ${temp}</div>
        <div><strong>Visibility:</strong> ${vis}</div>
        <div><strong>Ceiling:</strong> <span class="red">${ceil}</span></div>
        <div><strong>Pressure:</strong> ${pressure}</div>
        <div><strong>Best Runway:</strong> ${bestRwy}</div>
        <div><strong>Wind vs Runway:</strong> ${angleToRwy}Â° â€“ ${windType}</div>
      `;
    }
  </script>
</body>
</html>
